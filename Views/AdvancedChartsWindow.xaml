<Window x:Class="FleetManager.Views.AdvancedChartsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:FleetManager.Views"
        mc:Ignorable="d"
        Title="Graphiques AvancÃ©s - Fleet Manager"
        Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized">

    <Window.Resources>
        <!-- Styles personnalisÃ©s -->
        <Style x:Key="ChartContainerStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="10"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.1"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ChartTitleStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#333333"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="LegendItemStyle" TargetType="StackPanel">
            <Setter Property="Orientation" Value="Horizontal"/>
            <Setter Property="Margin" Value="5,2"/>
        </Style>

        <Style x:Key="ControlButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#2196F3"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="5"/>
            
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
    </Window.Resources>

    <Grid Background="#F8F9FA">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- En-tÃªte -->
        <Border Grid.Row="0" Background="White" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="ðŸ“Š Graphiques AvancÃ©s" FontSize="24" FontWeight="Bold" VerticalAlignment="Center"/>
                    <TextBlock Text="Analyse visuelle des performances de la flotte" FontSize="12" Foreground="#666666"
                               VerticalAlignment="Bottom" Margin="20,0,0,2"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="ðŸ”„ Actualiser" Click="Refresh_Click"
                            Style="{StaticResource ControlButtonStyle}"/>
                        <Button Content="ðŸ“Š Export PDF" Click="ExportPdf_Click"
                            Background="#4CAF50" Foreground="White" BorderThickness="0"
                            Padding="12,6" Margin="5" Cursor="Hand" FontWeight="SemiBold"/>
                        <Button Content="ðŸ“¸ Export Image" Click="ExportImage_Click"
                            Background="#FF9800" Foreground="White" BorderThickness="0"
                            Padding="12,6" Margin="5" Cursor="Hand" FontWeight="SemiBold"/>
                        <Button Content="âŒ Fermer" Click="CloseButton_Click"
                            Background="#F44336" Foreground="White" BorderThickness="0"
                            Padding="12,6" Margin="5" Cursor="Hand" FontWeight="SemiBold"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ContrÃ´les de filtre - simplifiÃ©s -->
        <Border Grid.Row="1" Background="White" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Padding="20,10">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="ðŸ“Š Visualisation complÃ¨te des donnÃ©es de la flotte" FontSize="13" Foreground="#666666" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding TotalVehicles, StringFormat='Total: {0} vÃ©hicules'}" FontSize="12" FontWeight="SemiBold"
                           Foreground="#2196F3" Margin="30,0,0,0" VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Contenu des graphiques -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Padding="10">
            <StackPanel>

                <!-- PremiÃ¨re ligne de graphiques -->
                <Grid Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Graphique d'Ã©volution des coÃ»ts -->
                    <Border Grid.Column="0" Style="{StaticResource ChartContainerStyle}">
                        <StackPanel>
                            <TextBlock Style="{StaticResource ChartTitleStyle}" Text="ðŸ“ˆ Ã‰volution des CoÃ»ts Mensuels"/>

                            <Grid Height="300">
                                <Canvas Background="#FAFAFA" Margin="40,20,20,40">
                                    <!-- Axes -->
                                    <Line X1="0" Y1="260" X2="400" Y2="260" Stroke="#CCCCCC" StrokeThickness="2"/>
                                    <Line X1="0" Y1="0" X2="0" Y2="260" Stroke="#CCCCCC" StrokeThickness="2"/>

                                    <!-- DonnÃ©es de coÃ»ts (simulation) -->
                                    <ItemsControl x:Name="CostChartData" Canvas.Left="20" Canvas.Top="20">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <Canvas/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <StackPanel>
                                                    <!-- Barre carburant -->
                                                    <Rectangle Fill="#2196F3" Width="25" Height="80" Canvas.Left="{Binding XPosition}" Canvas.Top="160"/>
                                                    <!-- Barre maintenance -->
                                                    <Rectangle Fill="#FF9800" Width="25" Height="40" Canvas.Left="{Binding XPosition}" Canvas.Top="120"/>
                                                    <!-- Ã‰tiquette -->
                                                    <TextBlock Text="{Binding Label}" FontSize="8" Canvas.Left="{Binding XPosition}" Canvas.Top="270"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <!-- Ã‰tiquettes des axes -->
                                    <TextBlock Text="â‚¬" Canvas.Left="-15" Canvas.Top="0" FontSize="10" Foreground="#666666"/>
                                    <TextBlock Text="0" Canvas.Left="-15" Canvas.Top="260" FontSize="10" Foreground="#666666"/>
                                    <TextBlock Text="Mois" Canvas.Left="380" Canvas.Top="270" FontSize="10" Foreground="#666666"/>
                                </Canvas>

                                <!-- LÃ©gende -->
                                <StackPanel HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,10,20,0">
                                    <StackPanel Style="{StaticResource LegendItemStyle}">
                                        <Rectangle Fill="#2196F3" Width="15" Height="10"/>
                                        <TextBlock Text="Carburant" FontSize="10" Margin="5,0"/>
                                    </StackPanel>
                                    <StackPanel Style="{StaticResource LegendItemStyle}">
                                        <Rectangle Fill="#FF9800" Width="15" Height="10"/>
                                        <TextBlock Text="Maintenance" FontSize="10" Margin="5,0"/>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Graphique de consommation par vÃ©hicule -->
                    <Border Grid.Column="1" Style="{StaticResource ChartContainerStyle}">
                        <StackPanel>
                            <TextBlock Style="{StaticResource ChartTitleStyle}" Text="â›½ Consommation par VÃ©hicule"/>

                            <Grid Height="300">
                                <Canvas Background="#FAFAFA" Margin="40,20,20,40">
                                    <!-- Graphique en barres horizontales -->
                                    <ItemsControl x:Name="ConsumptionChartData" Canvas.Left="0" Canvas.Top="20">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Height="25" Margin="0,2">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="100"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="50"/>
                                                    </Grid.ColumnDefinitions>

                                                    <TextBlock Grid.Column="0" Text="{Binding VehicleId}" FontSize="9" VerticalAlignment="Center"/>
                                                    <Rectangle Grid.Column="1" Fill="#4CAF50" Height="20" HorizontalAlignment="Left" Width="{Binding ConsumptionWidth}"/>
                                                    <TextBlock Grid.Column="2" Text="{Binding Consumption}" FontSize="9" VerticalAlignment="Center"/>
                                                </Grid>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </Canvas>
                            </Grid>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- DeuxiÃ¨me ligne de graphiques -->
                <Grid Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Graphique de tendance de performance -->
                    <Border Grid.Column="0" Style="{StaticResource ChartContainerStyle}">
                        <StackPanel>
                            <TextBlock Style="{StaticResource ChartTitleStyle}" Text="ðŸ“Š Tendances de Performance (90 jours)"/>

                            <Grid Height="350">
                                <Canvas Background="#FAFAFA" Margin="50,20,30,50">
                                    <!-- Grille de fond -->
                                    <ItemsControl x:Name="GridLines">
                                        <Line X1="0" Y1="70" X2="500" Y2="70" Stroke="#E0E0E0" StrokeThickness="1" StrokeDashArray="2,2"/>
                                        <Line X1="0" Y1="140" X2="500" Y2="140" Stroke="#E0E0E0" StrokeThickness="1" StrokeDashArray="2,2"/>
                                        <Line X1="0" Y1="210" X2="500" Y2="210" Stroke="#E0E0E0" StrokeThickness="1" StrokeDashArray="2,2"/>
                                        <Line X1="125" Y1="0" X2="125" Y2="280" Stroke="#E0E0E0" StrokeThickness="1" StrokeDashArray="2,2"/>
                                        <Line X1="250" Y1="0" X2="250" Y2="280" Stroke="#E0E0E0" StrokeThickness="1" StrokeDashArray="2,2"/>
                                        <Line X1="375" Y1="0" X2="375" Y2="280" Stroke="#E0E0E0" StrokeThickness="1" StrokeDashArray="2,2"/>
                                    </ItemsControl>

                                    <!-- Ligne de tendance consommation -->
                                    <Polyline x:Name="ConsumptionTrendLine" Stroke="#2196F3" StrokeThickness="3" Fill="None"/>

                                    <!-- Ligne de tendance coÃ»ts -->
                                    <Polyline x:Name="CostTrendLine" Stroke="#FF9800" StrokeThickness="3" Fill="None"/>

                                    <!-- Points de donnÃ©es -->
                                    <ItemsControl x:Name="DataPoints">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Ellipse Fill="#2196F3" Width="8" Height="8" Canvas.Left="{Binding X}" Canvas.Top="{Binding Y}"/>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <!-- Axes -->
                                    <Line X1="0" Y1="280" X2="500" Y2="280" Stroke="#333333" StrokeThickness="2"/>
                                    <Line X1="0" Y1="0" X2="0" Y2="280" Stroke="#333333" StrokeThickness="2"/>

                                    <!-- Ã‰tiquettes -->
                                    <TextBlock Text="Janv" Canvas.Left="100" Canvas.Top="290" FontSize="9" HorizontalAlignment="Center"/>
                                    <TextBlock Text="Mars" Canvas.Left="225" Canvas.Top="290" FontSize="9" HorizontalAlignment="Center"/>
                                    <TextBlock Text="Mai" Canvas.Left="350" Canvas.Top="290" FontSize="9" HorizontalAlignment="Center"/>

                                    <TextBlock Text="Ã‰levÃ©" Canvas.Left="-45" Canvas.Top="10" FontSize="9"/>
                                    <TextBlock Text="Moyen" Canvas.Left="-45" Canvas.Top="130" FontSize="9"/>
                                    <TextBlock Text="Faible" Canvas.Left="-45" Canvas.Top="250" FontSize="9"/>
                                </Canvas>

                                <!-- LÃ©gende pour les lignes de tendance -->
                                <StackPanel HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,20,30,0">
                                    <StackPanel Style="{StaticResource LegendItemStyle}">
                                        <Line X1="0" Y1="5" X2="20" Y2="5" Stroke="#2196F3" StrokeThickness="3"/>
                                        <TextBlock Text="Consommation" FontSize="10" Margin="5,0"/>
                                    </StackPanel>
                                    <StackPanel Style="{StaticResource LegendItemStyle}">
                                        <Line X1="0" Y1="5" X2="20" Y2="5" Stroke="#FF9800" StrokeThickness="3"/>
                                        <TextBlock Text="CoÃ»ts" FontSize="10" Margin="5,0"/>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Graphique circulaire de rÃ©partition -->
                    <Border Grid.Column="1" Style="{StaticResource ChartContainerStyle}">
                        <StackPanel>
                            <TextBlock Style="{StaticResource ChartTitleStyle}" Text="ðŸ¥§ RÃ©partition par Type"/>

                            <Grid Height="350">
                                <Canvas Background="#FAFAFA" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <!-- Graphique circulaire simulÃ© avec des arcs -->
                                    <Ellipse Width="200" Height="200" Stroke="#E0E0E0" StrokeThickness="2" Fill="Transparent"/>

                                    <!-- Secteurs du camembert (simulation avec des rectangles colorÃ©s) -->
                                    <StackPanel Canvas.Left="220" Canvas.Top="20">
                                        <StackPanel Style="{StaticResource LegendItemStyle}" Margin="0,5">
                                            <Rectangle Fill="#2196F3" Width="20" Height="15"/>
                                            <TextBlock Text="Voitures (45%)" FontSize="10" Margin="10,0"/>
                                        </StackPanel>
                                        <StackPanel Style="{StaticResource LegendItemStyle}" Margin="0,5">
                                            <Rectangle Fill="#4CAF50" Width="20" Height="15"/>
                                            <TextBlock Text="Utilitaires (30%)" FontSize="10" Margin="10,0"/>
                                        </StackPanel>
                                        <StackPanel Style="{StaticResource LegendItemStyle}" Margin="0,5">
                                            <Rectangle Fill="#FF9800" Width="20" Height="15"/>
                                            <TextBlock Text="Camions (20%)" FontSize="10" Margin="10,0"/>
                                        </StackPanel>
                                        <StackPanel Style="{StaticResource LegendItemStyle}" Margin="0,5">
                                            <Rectangle Fill="#9C27B0" Width="20" Height="15"/>
                                            <TextBlock Text="Motos (5%)" FontSize="10" Margin="10,0"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Valeurs centrales -->
                                    <StackPanel Canvas.Left="70" Canvas.Top="85" HorizontalAlignment="Center">
                                        <TextBlock Text="Total" FontSize="12" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="156" FontSize="20" FontWeight="Bold" HorizontalAlignment="Center" Foreground="#2196F3"/>
                                        <TextBlock Text="vÃ©hicules" FontSize="10" HorizontalAlignment="Center" Foreground="#666666"/>
                                    </StackPanel>
                                </Canvas>
                            </Grid>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- TroisiÃ¨me ligne - Graphique comparatif -->
                <Border Style="{StaticResource ChartContainerStyle}" Margin="10,10,10,0">
                    <StackPanel>
                        <TextBlock Style="{StaticResource ChartTitleStyle}" Text="ðŸ† Comparaison de Performance des VÃ©hicules"/>

                        <Grid Height="400">
                            <Canvas Background="#FAFAFA" Margin="80,30,30,60">
                                <!-- Radar chart simulation avec des polygones -->
                                <Canvas.RenderTransform>
                                    <TranslateTransform X="200" Y="150"/>
                                </Canvas.RenderTransform>

                                <!-- Axes du radar (5 critÃ¨res) -->
                                <Line X1="0" Y1="0" X2="0" Y2="-120" Stroke="#CCCCCC" StrokeThickness="1"/>
                                <Line X1="0" Y1="0" X2="114" Y2="-37" Stroke="#CCCCCC" StrokeThickness="1"/>
                                <Line X1="0" Y1="0" X2="71" Y2="97" Stroke="#CCCCCC" StrokeThickness="1"/>
                                <Line X1="0" Y1="0" X2="-71" Y2="97" Stroke="#CCCCCC" StrokeThickness="1"/>
                                <Line X1="0" Y1="0" X2="-114" Y2="-37" Stroke="#CCCCCC" StrokeThickness="1"/>

                                <!-- Cercles concentriques -->
                                <Ellipse Width="80" Height="80" Stroke="#E0E0E0" StrokeThickness="1" Fill="Transparent" Canvas.Left="-40" Canvas.Top="-40"/>
                                <Ellipse Width="160" Height="160" Stroke="#E0E0E0" StrokeThickness="1" Fill="Transparent" Canvas.Left="-80" Canvas.Top="-80"/>
                                <Ellipse Width="240" Height="240" Stroke="#E0E0E0" StrokeThickness="1" Fill="Transparent" Canvas.Left="-120" Canvas.Top="-120"/>

                                <!-- Ã‰tiquettes des axes -->
                                <TextBlock Text="Consommation" Canvas.Left="-30" Canvas.Top="-140" FontSize="10" FontWeight="Bold"/>
                                <TextBlock Text="CoÃ»ts" Canvas.Left="120" Canvas.Top="-50" FontSize="10" FontWeight="Bold"/>
                                <TextBlock Text="FiabilitÃ©" Canvas.Left="80" Canvas.Top="100" FontSize="10" FontWeight="Bold"/>
                                <TextBlock Text="Maintenance" Canvas.Left="-120" Canvas.Top="100" FontSize="10" FontWeight="Bold"/>
                                <TextBlock Text="DisponibilitÃ©" Canvas.Left="-150" Canvas.Top="-50" FontSize="10" FontWeight="Bold"/>

                                <!-- Polygone de performance vÃ©hicule 1 -->
                                <Polygon Points="0,-80 60,-25 40,60 -40,60 -60,-25"
                                         Fill="#2196F3" Opacity="0.3" Stroke="#2196F3" StrokeThickness="2"/>

                                <!-- Polygone de performance vÃ©hicule 2 -->
                                <Polygon Points="0,-100 80,-30 30,80 -30,80 -80,-30"
                                         Fill="#4CAF50" Opacity="0.3" Stroke="#4CAF50" StrokeThickness="2"/>
                            </Canvas>

                            <!-- LÃ©gende pour le radar -->
                            <StackPanel HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,30,50,0">
                                <StackPanel Style="{StaticResource LegendItemStyle}">
                                    <Rectangle Fill="#2196F3" Width="15" Height="10"/>
                                    <TextBlock Text="AA-123-BB" FontSize="10" Margin="5,0"/>
                                </StackPanel>
                                <StackPanel Style="{StaticResource LegendItemStyle}">
                                    <Rectangle Fill="#4CAF50" Width="15" Height="10"/>
                                    <TextBlock Text="CC-456-DD" FontSize="10" Margin="5,0"/>
                                </StackPanel>
                                <TextBlock Text="Ã‰chelle: 0-100" FontSize="9" Foreground="#666666" Margin="0,10,0,0"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- ContrÃ´les d'export et d'analyse -->
                <Border Style="{StaticResource ChartContainerStyle}" Margin="10,10,10,20">
                    <StackPanel>
                        <TextBlock Style="{StaticResource ChartTitleStyle}" Text="ðŸ“Š Outils d'Analyse"/>

                        <WrapPanel HorizontalAlignment="Center" Margin="0,20">
                            <Button Content="ðŸ“¸ Capturer graphiques" Style="{StaticResource ControlButtonStyle}"/>
                            <Button Content="ðŸ“„ Rapport PDF complet" Style="{StaticResource ControlButtonStyle}" Background="#4CAF50"/>
                            <Button Content="ðŸ“Š Export Excel dÃ©taillÃ©" Style="{StaticResource ControlButtonStyle}" Background="#FF9800"/>
                            <Button Content="ðŸŽ¯ DÃ©finir seuils d'alerte" Style="{StaticResource ControlButtonStyle}" Background="#9C27B0"/>
                            <Button Content="ðŸ“§ Programmer envoi automatique" Style="{StaticResource ControlButtonStyle}" Background="#607D8B"/>
                            <Button Content="ðŸ”„ Actualisation automatique" Style="{StaticResource ControlButtonStyle}" Background="#795548"/>
                        </WrapPanel>

                        <TextBlock Text="ðŸ’¡ Conseil: Utilisez les filtres en haut de page pour personnaliser les graphiques selon vos besoins d'analyse."
                                   FontSize="11" Foreground="#666666" HorizontalAlignment="Center" Margin="0,15,0,0"
                                   FontStyle="Italic"/>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>
